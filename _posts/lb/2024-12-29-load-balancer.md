---
title: "로드 밸런서 정리"
toc: true
toc_sticky: true
date: 2024-12-29
categories: lb
comments: true
---

## 1. 로드 밸런서란?
<p>
	<img src = "/assets/images/network/lb/LoadBalancer(1).png">
 </p>
<br/>
로드 밸런싱이란 서버에 가해지는 부하들을 분산해주는 기술을 말한다. 한 대의 서버가 있다고 가정했을 때 서비스가 점점 커지면 한 대의 서버로는 정상적인 운영이 힘들 수 있다.

이럴 때 서버의 스펙을 올리는 방법도 있겠지만 여러 대의 서버를 두어서 부하를 분산 시키는 것도 좋은 방법이다.

## 2. L4 vs L7 로드 밸런서
로드 밸런싱은 네트워크 통신 국제 표준 모델인 OSI 7 layer(L1, L2 ... L7) 중 **L4 로드 밸런서** 와 **L7 로드 밸런서**가 있다.

### 2-1) L4
1. **네트워크 계층**(L4:TCP/UDP 등..)에서 동작한다.
2. IP, 포트, 프로토콜 등 **패킷 수준의 정보만 확인**해서 분산 처리를 하기 때문에 **대기시간이 L7에 비해서 짧다**.
3. 패킷 정보만으로 트래픽을 분배하기 때문에 유연성이 낮다.
4. 인프라단에서 SSL 적용이 불가능하기 떄문에, 어플리케이션에 직접 적용해주어야 한다.
5. 서버와 연결이 가능한지는 확인 가능하지만 그 서버의 어플리케이션의 동작 여부까지는 확인이 어렵다.

### 2-2) L7
1. **애플리케이션 계층**(L7:HTTP/HTTPS 등)에서 동작한다.
2. 요청 본문, 헤더, URL 등을 추가로 분석하기 때문에 **대기시간이 상대적으로 길다**.
3. 요청 데이터에 대한 세밀한 분석이 가능해서 유연성이 높다.
4. 인프라단에서 SSL 적용이 가능하다.
5. 통신하려는 서버의 어플리케이션 정상 동작 여부 확인까지 가능하다.

## 3. 로드 밸런서 알고리즘
### 3-1) 라운드 로빈
- 들어온 요청을 순차적으로 서버에 분배한다.
- 서버 상태를 고려하지 않고 순차적으로 트래픽을 분배하기 때문에 서버 간 부하가 불균형 할 수 있다.

### 3-2) 가중치 라운드 로빈
- 각 서버에 가중치를 부여하고, 가중치에 비례하여 요청을 분배한다.
- 서버 A의 가중치가 2이고 서버 B의 가중치가 1이라면, 요청의 2/3은 서버 A로, 1/3은 서버 B로 전달된다.
- 서버의 처리 능력에 따라 부하 분산이 가능하다.

### 3-3) 최소 연결
- 현재 서버의 부하를 실시간 모니터링 해서 활성 연결 수가 가장 적은 서버로 요청을 보낸다.

### 3-4) 최소 연결 시간
- 서버의 응답시간이 가장 짧은 서버로 요청을 분배한다.
- 서버의 응답시간과 부하를 모두 고려 가능하다.


(이 밖에도 IP기반으로 분산, URL 기반으로 분산, 특정 패턴에 대해 분산 등 알고리즘은 많으니 필요하면 찾아보도록 하자)